---
title: "JVMS0001: Stack map frame error"
description: "Invalid or inconsistent stack map frame in bytecode"
error_code: "JVMS0001"
severity: "jvm_spec"
---

# JVMS0001: Stack map frame error

**Severity**: JVM Specification Warning  
**Category**: Bytecode Validation

## Description

This warning indicates a problem with stack map frames, which are used for bytecode verification in Java 6 and later. Stack map frames must correctly describe the operand stack and local variables at each branch target.

## Common Causes

1. Inconsistent stack heights at merge points
2. Incorrect variable types in stack map frames
3. Missing stack map frames at required locations
4. Type mismatches between frames and actual code
5. Invalid frame types (full vs compressed vs same)

## Example

```rns
.class public Example
.super java/lang/Object

.method public static test(Z)I
    .limit stack 1
    .limit locals 2
    
    iload_0
    ifeq false_branch
    
    ; True branch: pushes int
    iconst_1
    goto end
    
  false_branch:
    ; False branch: pushes String (type mismatch!)
    ldc "error"
    
  end:
    ; ERROR: Inconsistent stack types at merge point
    ireturn
.end method
```

## Solution

1. **Ensure consistent types**: All paths to a merge point must have compatible stack types.
2. **Use frame directives**: Explicitly specify stack map frames with `.stack` directive.
3. **Let assembler generate frames**: Use `--generate-stack-maps` for automatic frame generation.
4. **Verify with javac**: Compare with equivalent Java code compiled with `-g:vars`.

## Stack Map Frame Rules

According to JVM Specification §4.7.4:

1. **Full frames** explicitly specify stack and local types
2. **Same frames** indicate no change from previous frame
3. **Append frames** add new locals to the frame
4. **Chop frames** remove locals from the frame
5. **All targets** of a jump must have compatible frames

## Related Warnings

- [JVMS0000: Invalid constant pool index](/errors/jvms0000/)
- [JVMS0002: Type mismatch in verification](/errors/jvms0002/)
- [E0002: Stack underflow](/errors/e0002/)

## Assembler Output

```
JVM Spec Warning JVMS0001 at line 18, column 5: Stack map frame error at label 'end'
  → Inconsistent stack types from different branches:
    - From 'ifne' (true branch): stack=[int]
    - From 'false_branch': stack=[String]
  → Merge point requires compatible types (both Object or both int)
  → Consider: adding checkcast or using common supertype
  → This may cause VerifyError at runtime
```